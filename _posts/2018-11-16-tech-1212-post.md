---
title: "html_node ë§ˆìš°ìŠ¤ ì´ë™ ì²˜ë¦¬ í•¨ìˆ˜. toDraggable"
date: 2018-11-16 23:24:45 +0900
categories: 
---
[ğŸ”—link](http://www.mins01.com/mh/tech/read/1212)
***


[http://www.mins01.com/mh/tech/read/1217](http://www.mins01.com/mh/tech/read/1217 "http://www.mins01.com/mh/tech/read/1217")

ì´ìª½ìœ¼ë¡œ ì˜®ê²¼ìŒ

  


Â  /**

Â  * toDraggable

Â  * @paramÂ  {html_node} target

Â  * @paramÂ  {function} cb_onpointerdown

Â  * @paramÂ  {function} cb_onpointermove

Â  * @paramÂ  {function} cb_onpointerup

Â  * @return {object} {"enable":function , "disable":function}

Â  */



Â  var toDraggable = function(target,cb_onpointerdown,cb_onpointermove,cb_onpointerup){

Â  Â  var data={

Â  Â  Â  "ing":false,

Â  Â  Â  "x0":0,

Â  Â  Â  "y0":0

Â  Â  }

Â  Â  var _getXY = function(evt){

Â  Â  Â  var x = evt.clientX;

Â  Â  Â  var y = evt.clientY;

Â  Â  Â  if(evt.isPrimary ){

Â  Â  Â  Â  var x = evt.clientX;

Â  Â  Â  Â  var y = evt.clientY;

Â  Â  Â  }else if(evt.touches &amp;&amp; evt.touches[0]){

Â  Â  Â  Â  var touch = evt.touches[0];

Â  Â  Â  Â  var x = touch.X;

Â  Â  Â  Â  var y = touch.Y;

Â  Â  Â  }else{

Â  Â  Â  Â  var x = evt.x;

Â  Â  Â  Â  var y = evt.y;

Â  Â  Â  }

Â  Â  Â  return [x,y];

Â  Â  }

Â  Â  var _onpointerdown = function(target,data,cb_onpointerdown){

Â  Â  Â  // var target = evt.target;

Â  Â  Â  return function(evt){

Â  Â  Â  Â  data.ing = true;

Â  Â  Â  Â  var xy = _getXY(evt);

Â  Â  Â  Â  data.x0 = xy[0];

Â  Â  Â  Â  data.y0 = xy[1];

Â  Â  Â  Â  var r = true;

Â  Â  Â  Â  if(cb_onpointerdown){

Â  Â  Â  Â  Â  r = cb_onpointerdown(evt,xy[0],xy[1]);

Â  Â  Â  Â  }

Â  Â  Â  Â  if(r){Â 

Â  Â  Â  Â  Â  evt.preventDefault();evt.stopPropagation();Â 

Â  Â  Â  Â  Â  document.addEventListener('pointermove',_onpointermove);

Â  Â  Â  Â  Â  document.addEventListener('pointerup',_onpointerup);

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  return false;

Â  Â  Â  }

Â  Â  }(target,data,cb_onpointerdown)

Â  Â  var _onpointermove = function(target,data,cb_onpointermove){

Â  Â  Â  return function(evt){

Â  Â  Â  Â  if(!data.ing){return;}

Â  Â  Â  Â  var xy = _getXY(evt);

Â  Â  Â  Â  var gapX = xy[0]-data.x0;

Â  Â  Â  Â  var gapY = xy[1]-data.y0;

Â  Â  Â  Â  data.x0 = xy[0];

Â  Â  Â  Â  data.y0 = xy[1];

Â  Â  Â  Â  var r = true;

Â  Â  Â  Â  if(cb_onpointermove){

Â  Â  Â  Â  Â  r = cb_onpointermove(evt,gapX,gapY);

Â  Â  Â  Â  }

Â  Â  Â  Â  if(r){ evt.preventDefault();evt.stopPropagation(); }

Â  Â  Â  Â  return false;

Â  Â  Â  }

Â  Â  }(target,data,cb_onpointermove)

Â  Â  var _onpointerup = function(target,data,cb_onpointerup){

Â  Â  Â  return function(evt){

Â  Â  Â  Â  var r = true;

Â  Â  Â  Â  if(data.ing &amp;&amp; cb_onpointerup){

Â  Â  Â  Â  Â  r = cb_onpointerup(evt);

Â  Â  Â  Â  }

Â  Â  Â  Â  data.ing = false;

Â  Â  Â  Â  if(r){Â 

Â  Â  Â  Â  Â  evt.preventDefault();evt.stopPropagation();

Â  Â  Â  Â  Â  document.removeEventListener('pointermove',_onpointermove);

Â  Â  Â  Â  Â  document.removeEventListener('pointerup',_onpointerup);

Â  Â  Â  Â  }

Â  Â  Â  Â  return false;

Â  Â  Â  }

Â  Â  }(target,data,cb_onpointerup)

Â  Â  var _notouchmove = function(evt){ evt.preventDefault();evt.stopPropagation()	;return false;}

Â  Â  var _enable = false;

Â  Â  var enable = function(){

Â  Â  Â  if(!_enable){

Â  Â  Â  Â  target.addEventListener('pointerdown',_onpointerdown);

Â  Â  Â  Â  target.addEventListener('touchmove',_notouchmove);Â Â 

Â  Â  Â  Â  _enable = true;

Â  Â  Â  }

Â  Â  Â Â 

Â  Â  }

Â  Â  var disable = function(){

Â  Â  Â  if(_enable){

Â  Â  Â  Â  target.removeEventListener('pointerdown',_onpointerdown);

Â  Â  Â  Â  target.removeEventListener('touchmove',_notouchmove);

Â  Â  Â  Â  _enable = false;

Â  Â  Â  }

Â  Â  }

Â  Â  enable();

Â  Â Â 

Â  Â  return {"enable":enable,"disable":disable}

Â  }



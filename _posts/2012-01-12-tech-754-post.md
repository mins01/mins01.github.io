---
title: "curl 사용 예제"
date: 2012-01-12 16:42:22 +0900
categories: [curl, php]
---

function getContentURL($url,$postData=null){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn = curl_init($url);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;=&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;3;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$exec_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt; =&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;3;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_HEADER, false); //응답헤더 OFF. ON 할경우 받는 파일에 헤더가 붙음.&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //응답 내용 가져올지 여부. TRUE면 내용을 리턴. FALSE면 직접 브라우저에 출력&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 mins01"); //User Agent 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //서버 접속시 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $exec_timeout); //서버 접속시 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec 실행시간 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($postData)){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POST, TRUE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST 전송&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postData);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST값 세팅&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = curl_exec($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = curl_error($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = curl_errno($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return $result;}  
쿠키, 기타 해더 등이 있지만...그냥 알아서 추가하시오/  
  
- - - - - -

//$postRow =&amp;gt; xxx=yyy&amp;amp;zzz=ttt  
//$cookieRaw=&amp;gt; xxx=yyy; zzz=ttt;  
&lt;div&gt;function getContentURL($url,$postRaw=null,$cookieRaw=null)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result = array();&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['header'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['body'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errormsg'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errorno'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['httpcode'] = '404';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//return $result; //에러처리&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$c_url = $url;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space: pre;"&amp;gt;&amp;lt;/span&amp;gt;//$c_url = 'http://XXXX/proxy2.php?url='.urlencode($url); //프록시 사용시&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$conn = curl_init($c_url);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$conn_timeout&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;=&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;5;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$exec_timeout&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt; =&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;5;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_HEADER, true); //응답헤더 OFF. ON 할경우 받는 파일에 헤더가 붙음.&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //응답 내용 가져올지 여부. TRUE면 내용을 리턴. FALSE면 직접 브라우저에 출력&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 sdgd"); //User Agent 설정&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36"); //User Agent 설정&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //서버 접속시 timeout 설정&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_TIMEOUT, $exec_timeout); //서버 접속시 timeout 설정&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec 실행시간 timeout 설정&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(isset($postRaw[0])){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_POST, TRUE);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POST 전송&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postRaw);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POST값 세팅&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(isset($cookieRaw[0])){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_COOKIE, $cookieRaw);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POST값 세팅&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$data = curl_exec($conn);&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;printrr($data);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$split_result = split("\r\n\r\n", $data, 2);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['header'] = isset($split_result[0])?$split_result[0]:'';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['body'] = isset($split_result[1])?$split_result[1]:'';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errormsg'] = curl_error($conn);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errorno'] = curl_errno($conn);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;@curl_close($conn);&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;printrr($result);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//exit();&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return $result;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;- - - - - -

#유틸 함수# PHP 5이상용&lt;div&gt;function posts2raw($posts){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return http_build_query($posts, '', '&amp;amp;amp;amp;'); &lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;function cookies2raw($cookies){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(count($cookies==0)){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return http_build_query($cookies, '', '; '); &lt;/div&gt;&lt;div&gt;}&lt;/div&gt;  
- - - - - -

#SSL문제시 옵션  
#ssl 인증관련 동작 안하도록 함.&lt;div&gt;curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, FALSE);&lt;/div&gt;&lt;div&gt;curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, FALSE);&lt;/div&gt;


[🔗link](http://www.mins01.com/mh/tech/read/754)
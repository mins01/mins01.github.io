---
title: "curl ì‚¬ìš© ì˜ˆì œ"
date: 2012-01-12 16:42:22 +0900
categories: [curl, php]
---

function getContentURL($url,$postData=null){$conn = curl_init($url);$conn_timeout=3;$exec_timeout =3;curl_setopt($conn, CURLOPT_HEADER, false); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 mins01"); //User Agent ì„¤ì •curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •if(isset($postData)){curl_setopt($conn, CURLOPT_POST, TRUE);//POST ì „ì†¡curl_setopt($conn, CURLOPT_POSTFIELDS, $postData);//POSTê°’ ì„¸íŒ…}$result['body'] = curl_exec($conn);$result['errormsg'] = curl_error($conn);$result['errorno'] = curl_errno($conn);$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);return $result;}  
ì¿ í‚¤, ê¸°íƒ€ í•´ë” ë“±ì´ ìˆì§€ë§Œ...ê·¸ëƒ¥ ì•Œì•„ì„œ ì¶”ê°€í•˜ì‹œì˜¤/  
  
- - - - - -

//$postRow =&gt; xxx=yyy&amp;zzz=ttt  
//$cookieRaw=&gt; xxx=yyy; zzz=ttt;  
function getContentURL($url,$postRaw=null,$cookieRaw=null){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result = array();&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['header'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = '404';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//return $result; //ì—ëŸ¬ì²˜ë¦¬&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$c_url = $url;&lt;span class="Apple-tab-span" style="white-space: pre;"&gt;&lt;/span&gt;//$c_url = 'http://XXXX/proxy2.php?url='.urlencode($url); //í”„ë¡ì‹œ ì‚¬ìš©ì‹œ  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn = curl_init($c_url);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;=&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;5;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$exec_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt; =&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;5;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_HEADER, true); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 sdgd"); //User Agent ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36"); //User Agent ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_TIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($postRaw[0])){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POST, TRUE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST ì „ì†¡&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postRaw);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POSTê°’ ì„¸íŒ…&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($cookieRaw[0])){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_COOKIE, $cookieRaw);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POSTê°’ ì„¸íŒ…&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$data = curl_exec($conn);//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;printrr($data);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$split_result = split("\r\n\r\n", $data, 2);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['header'] = isset($split_result[0])?$split_result[0]:'';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = isset($split_result[1])?$split_result[1]:'';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = curl_error($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = curl_errno($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);  &#xD;
  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;@curl_close($conn);  &#xD;
//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;printrr($result);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//exit();  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return $result;}- - - - - -

#ìœ í‹¸ í•¨ìˆ˜# PHP 5ì´ìƒìš©function posts2raw($posts){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return http_build_query($posts, '', '&amp;amp;');Â }function cookies2raw($cookies){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(count($cookies==0)){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return http_build_query($cookies, '', '; ');Â }  
- - - - - -

#SSLë¬¸ì œì‹œ ì˜µì…˜  
#ssl ì¸ì¦ê´€ë ¨ ë™ì‘ ì•ˆí•˜ë„ë¡ í•¨.curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, FALSE);curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, FALSE);


[ğŸ”—link](http://www.mins01.com/mh/tech/read/754)
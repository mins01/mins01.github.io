---
title: "curl ì‚¬ìš© ì˜ˆì œ"
date: 2012-01-12 16:42:22 +0900
categories: 
---
  

function getContentURL($url,$postData=null)
{
	$conn = curl_init($url);
	$conn_timeout	=	3;
	$exec_timeout	 =	3;
	curl_setopt($conn, CURLOPT_HEADER, false); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.
	curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥
	curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 mins01"); //User Agent ì„¤ì •
	curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •
	curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •
	//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •
	if(isset($postData)){
		curl_setopt($conn, CURLOPT_POST, TRUE);				//POST ì „ì†¡
		curl_setopt($conn, CURLOPT_POSTFIELDS, $postData);		//POSTê°’ ì„¸íŒ…
	}
	
	
	$result['body'] = curl_exec($conn);
	$result['errormsg'] = curl_error($conn);
	$result['errorno'] = curl_errno($conn);
	$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);
	return $result;
}
  

ì¿ í‚¤, ê¸°íƒ€ í•´ë” ë“±ì´ ìˆì§€ë§Œ...
ê·¸ëƒ¥ ì•Œì•„ì„œ ì¶”ê°€í•˜ì‹œì˜¤/
  
  


- - - - - -

//$postRow =&gt; xxx=yyy&amp;zzz=ttt  
//$cookieRaw=&gt; xxx=yyy; zzz=ttt;
  

function getContentURL($url,$postRaw=null,$cookieRaw=null)
{
	$result = array();
	$result['header'] = '';
	$result['body'] = '';
	$result['errormsg'] = '';
	$result['errorno'] = '';
	$result['httpcode'] = '404';
	//return $result; //ì—ëŸ¬ì²˜ë¦¬
	$c_url = $url;
	//$c_url = 'http://XXXX/proxy2.php?url='.urlencode($url); //í”„ë¡ì‹œ ì‚¬ìš©ì‹œ
  

	$conn = curl_init($c_url);
	$conn_timeout	=	5;
	$exec_timeout	 =	5;
	curl_setopt($conn, CURLOPT_HEADER, true); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.
	curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥
//	curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 sdgd"); //User Agent ì„¤ì •
	curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36"); //User Agent ì„¤ì •
	curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •
	curl_setopt($conn, CURLOPT_TIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •
	//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •
	if(isset($postRaw[0])){
		curl_setopt($conn, CURLOPT_POST, TRUE);				//POST ì „ì†¡
		curl_setopt($conn, CURLOPT_POSTFIELDS, $postRaw);		//POSTê°’ ì„¸íŒ…
	}
  

	if(isset($cookieRaw[0])){
		curl_setopt($conn, CURLOPT_COOKIE, $cookieRaw);		//POSTê°’ ì„¸íŒ…
	}
  

	
	$data = curl_exec($conn);
//	printrr($data);
	$split_result = split("\r\n\r\n", $data, 2);
	$result['header'] = isset($split_result[0])?$split_result[0]:'';
	$result['body'] = isset($split_result[1])?$split_result[1]:'';
	$result['errormsg'] = curl_error($conn);
	$result['errorno'] = curl_errno($conn);
	$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);
  
  

	@curl_close($conn);
  

//	printrr($result);
	//exit();
  

	return $result;
}

- - - - - -


#ìœ í‹¸ í•¨ìˆ˜
# PHP 5ì´ìƒìš©
function posts2raw($posts){
	return http_build_query($posts, '', '&amp;amp;');Â 
}
function cookies2raw($cookies){
	if(count($cookies==0)){
		return '';
	}
	return http_build_query($cookies, '', '; ');Â 
}

  
- - - - - -

#SSLë¬¸ì œì‹œ ì˜µì…˜
  

#ssl ì¸ì¦ê´€ë ¨ ë™ì‘ ì•ˆí•˜ë„ë¡ í•¨.
curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, FALSE);





***
[ğŸ”—original-link](http://www.mins01.com/mh/tech/read/754)
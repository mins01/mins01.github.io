---
title: "curl 사용 예제"
date: 2012-01-12 16:42:22 +0900
categories: [curl, php]
---

function getContentURL($url,$postData=null){$conn = curl_init($url);$conn_timeout=3;$exec_timeout =3;curl_setopt($conn, CURLOPT_HEADER, false); //응답헤더 OFF. ON 할경우 받는 파일에 헤더가 붙음.curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //응답 내용 가져올지 여부. TRUE면 내용을 리턴. FALSE면 직접 브라우저에 출력curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 mins01"); //User Agent 설정curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //서버 접속시 timeout 설정curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $exec_timeout); //서버 접속시 timeout 설정//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec 실행시간 timeout 설정if(isset($postData)){curl_setopt($conn, CURLOPT_POST, TRUE);//POST 전송curl_setopt($conn, CURLOPT_POSTFIELDS, $postData);//POST값 세팅}$result['body'] = curl_exec($conn);$result['errormsg'] = curl_error($conn);$result['errorno'] = curl_errno($conn);$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);return $result;}  
쿠키, 기타 해더 등이 있지만...그냥 알아서 추가하시오/  
  
- - - - - -

//$postRow =&gt; xxx=yyy&amp;zzz=ttt  
//$cookieRaw=&gt; xxx=yyy; zzz=ttt;  
function getContentURL($url,$postRaw=null,$cookieRaw=null){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result = array();&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['header'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = '404';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//return $result; //에러처리&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$c_url = $url;&lt;span class="Apple-tab-span" style="white-space: pre;"&gt;&lt;/span&gt;//$c_url = 'http://XXXX/proxy2.php?url='.urlencode($url); //프록시 사용시  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn = curl_init($c_url);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;=&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;5;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$exec_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt; =&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;5;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_HEADER, true); //응답헤더 OFF. ON 할경우 받는 파일에 헤더가 붙음.&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //응답 내용 가져올지 여부. TRUE면 내용을 리턴. FALSE면 직접 브라우저에 출력//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 sdgd"); //User Agent 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36"); //User Agent 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //서버 접속시 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_TIMEOUT, $exec_timeout); //서버 접속시 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec 실행시간 timeout 설정&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($postRaw[0])){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POST, TRUE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST 전송&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postRaw);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST값 세팅&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($cookieRaw[0])){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_COOKIE, $cookieRaw);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST값 세팅&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$data = curl_exec($conn);//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;printrr($data);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$split_result = split("\r\n\r\n", $data, 2);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['header'] = isset($split_result[0])?$split_result[0]:'';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = isset($split_result[1])?$split_result[1]:'';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = curl_error($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = curl_errno($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);  &#xD;
  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;@curl_close($conn);  &#xD;
//&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;printrr($result);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//exit();  &#xD;
&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return $result;}- - - - - -

#유틸 함수# PHP 5이상용function posts2raw($posts){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return http_build_query($posts, '', '&amp;amp;'); }function cookies2raw($cookies){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(count($cookies==0)){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return '';&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return http_build_query($cookies, '', '; '); }  
- - - - - -

#SSL문제시 옵션  
#ssl 인증관련 동작 안하도록 함.curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, FALSE);curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, FALSE);


[🔗link](http://www.mins01.com/mh/tech/read/754)
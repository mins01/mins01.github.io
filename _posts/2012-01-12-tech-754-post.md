---
title: "curl ì‚¬ìš© ì˜ˆì œ"
date: 2012-01-12 16:42:22 +0900
categories: [curl, php]
---

function getContentURL($url,$postData=null){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn = curl_init($url);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$conn_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;=&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;3;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$exec_timeout&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt; =&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;3;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_HEADER, false); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 mins01"); //User Agent ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;if(isset($postData)){&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POST, TRUE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POST ì „ì†¡&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postData);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;//POSTê°’ ì„¸íŒ…&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;}&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['body'] = curl_exec($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errormsg'] = curl_error($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['errorno'] = curl_errno($conn);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);&lt;span class="Apple-tab-span" style="white-space:pre"&gt;&lt;/span&gt;return $result;}  
ì¿ í‚¤, ê¸°íƒ€ í•´ë” ë“±ì´ ìˆì§€ë§Œ...ê·¸ëƒ¥ ì•Œì•„ì„œ ì¶”ê°€í•˜ì‹œì˜¤/  
  
- - - - - -

//$postRow =&amp;gt; xxx=yyy&amp;amp;zzz=ttt  
//$cookieRaw=&amp;gt; xxx=yyy; zzz=ttt;  
&lt;div&gt;function getContentURL($url,$postRaw=null,$cookieRaw=null)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result = array();&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['header'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['body'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errormsg'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errorno'] = '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['httpcode'] = '404';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//return $result; //ì—ëŸ¬ì²˜ë¦¬&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$c_url = $url;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space: pre;"&amp;gt;&amp;lt;/span&amp;gt;//$c_url = 'http://XXXX/proxy2.php?url='.urlencode($url); //í”„ë¡ì‹œ ì‚¬ìš©ì‹œ&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$conn = curl_init($c_url);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$conn_timeout&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;=&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;5;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$exec_timeout&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt; =&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;5;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_HEADER, true); //ì‘ë‹µí—¤ë” OFF. ON í• ê²½ìš° ë°›ëŠ” íŒŒì¼ì— í—¤ë”ê°€ ë¶™ìŒ.&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_RETURNTRANSFER , true); //ì‘ë‹µ ë‚´ìš© ê°€ì ¸ì˜¬ì§€ ì—¬ë¶€. TRUEë©´ ë‚´ìš©ì„ ë¦¬í„´. FALSEë©´ ì§ì ‘ ë¸Œë¼ìš°ì €ì— ì¶œë ¥&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 sdgd"); //User Agent ì„¤ì •&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_USERAGENT,"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.71 Safari/537.36"); //User Agent ì„¤ì •&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_CONNECTTIMEOUT, $conn_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_TIMEOUT, $exec_timeout); //ì„œë²„ ì ‘ì†ì‹œ timeout ì„¤ì •&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//curl_setopt($conn, CURLOPT_TIMEOUT, $timeout); // curl exec ì‹¤í–‰ì‹œê°„ timeout ì„¤ì •&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(isset($postRaw[0])){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_POST, TRUE);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POST ì „ì†¡&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_POSTFIELDS, $postRaw);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POSTê°’ ì„¸íŒ…&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(isset($cookieRaw[0])){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;curl_setopt($conn, CURLOPT_COOKIE, $cookieRaw);&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//POSTê°’ ì„¸íŒ…&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$data = curl_exec($conn);&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;printrr($data);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$split_result = split("\r\n\r\n", $data, 2);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['header'] = isset($split_result[0])?$split_result[0]:'';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['body'] = isset($split_result[1])?$split_result[1]:'';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errormsg'] = curl_error($conn);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['errorno'] = curl_errno($conn);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;$result['httpcode'] = curl_getinfo($conn,CURLINFO_HTTP_CODE);&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;@curl_close($conn);&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;//&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;printrr($result);&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;//exit();&lt;/div&gt;&lt;div&gt;  &amp;#xD;
&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return $result;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;- - - - - -

#ìœ í‹¸ í•¨ìˆ˜# PHP 5ì´ìƒìš©&lt;div&gt;function posts2raw($posts){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return http_build_query($posts, '', '&amp;amp;amp;amp;');Â &lt;/div&gt;&lt;div&gt;}&lt;/div&gt;&lt;div&gt;function cookies2raw($cookies){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;if(count($cookies==0)){&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return '';&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;}&lt;/div&gt;&lt;div&gt;&amp;lt;span class="Apple-tab-span" style="white-space:pre"&amp;gt;&amp;lt;/span&amp;gt;return http_build_query($cookies, '', '; ');Â &lt;/div&gt;&lt;div&gt;}&lt;/div&gt;  
- - - - - -

#SSLë¬¸ì œì‹œ ì˜µì…˜  
#ssl ì¸ì¦ê´€ë ¨ ë™ì‘ ì•ˆí•˜ë„ë¡ í•¨.&lt;div&gt;curl_setopt($conn, CURLOPT_SSL_VERIFYPEER, FALSE);&lt;/div&gt;&lt;div&gt;curl_setopt($conn, CURLOPT_SSL_VERIFYHOST, FALSE);&lt;/div&gt;


[ğŸ”—link](http://www.mins01.com/mh/tech/read/754)
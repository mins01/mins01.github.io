---
title: "GET,POST값 등을 JAVASCRIPT에서 사용할 경우 보안 문제 발생 가능. 해결법"
date: 2014-03-12 10:53:24 +0900
categories: [security]
---

&lt;script&gt;

//&amp;lt;!-- or //&amp;lt;![CDATA[~~~ 내용 ~~~//--&amp;gt; or// ]]&amp;gt;  
&lt;div&gt;&amp;amp;lt;/script&amp;amp;gt;&lt;/div&gt;  
기본 자바스크립트 모양이 이럴건데&amp;lt;!-- 등 때문에 살짝 문제가됨.  
- - - - - -

  
# 문제점  
&amp;lt;script&amp;gt;&lt;div&gt;//&amp;amp;lt;!--&lt;/div&gt;&lt;div&gt;var req = "&amp;amp;lt;?=$_GET['req']?&amp;amp;gt;";&lt;/div&gt;&lt;div&gt;//--&amp;amp;gt;  &amp;#xD;
&amp;lt;div&amp;gt;&amp;amp;amp;lt;/script&amp;amp;amp;gt;&amp;lt;/div&amp;gt;&lt;/div&gt;처럼 할 경우req의 내용이";--&amp;gt; &amp;lt;script&amp;gt;alert('X');&amp;lt;/script&amp;gt;처럼 되어있다면?  
&amp;lt;script&amp;gt;&lt;div&gt;//&amp;amp;lt;!--&lt;/div&gt;&lt;div&gt;var req = "";--&amp;amp;gt; &amp;amp;lt;script&amp;amp;gt;alert('X');&amp;amp;lt;/script&amp;amp;gt;";&lt;/div&gt;&lt;div&gt;//--&amp;amp;gt;  &amp;#xD;
&amp;lt;div&amp;gt;&amp;amp;amp;lt;/script&amp;amp;amp;gt;&amp;lt;/div&amp;gt;&lt;/div&gt;이렇게 결과가 되며스크립트 동작에 문제가 있을 수 있다.(요즘 브라우저는 스크립트 공격으로 보고 스크립트 동작을 멈춘다.)  
$_GET말고도 DB의 내용등 PHP에서 javascript로 값을 남겨 사용할 경우도 똑같다.  
- - - - - -

  
#해결법  
&amp;lt;!-- 등의 HTML 주석 처리 부분을 빼고, htmlspecialchars() 를 사용한다.   
  
&amp;lt;script&amp;gt;&lt;div&gt;var req = "&amp;amp;lt;?=htmlspecialchars($_GET['req'])?&amp;amp;gt;";&lt;/div&gt;&lt;div&gt;&amp;lt;div&amp;gt;&amp;amp;amp;lt;/script&amp;amp;amp;gt;&amp;lt;/div&amp;gt;&lt;/div&gt;  
아래처럼 HTML엔터티 처리가되서 무사 OK&amp;lt;script&amp;gt;&lt;div&gt;var req = "&amp;amp;amp;quot;;--&amp;amp;amp;gt; &amp;amp;amp;lt;script&amp;amp;amp;gt;alert('X');&amp;amp;amp;lt;/script&amp;amp;amp;gt;";&lt;/div&gt;&lt;div&gt;&amp;amp;lt;/script&amp;amp;gt;&lt;/div&gt;  
- - - - - -

#추가스크립트 코딩시 &amp;amp;나 &amp;gt;,&amp;lt; 같은 단어의 엔터티 처리가 힘드므로  
&amp;lt;script&amp;gt;&lt;div&gt;var req = "&amp;amp;lt;?=htmlspecialchars($_GET['req'])?&amp;amp;gt;";&lt;/div&gt;&lt;div&gt;&amp;amp;lt;/script&amp;amp;gt;&lt;/div&gt;&amp;lt;script&amp;gt;//&amp;lt;!--var f  = document.form1;f.req.value = req;  
&lt;div&gt;//--&amp;amp;gt;&lt;/div&gt;&lt;div&gt;&amp;amp;lt;/script&amp;amp;gt;&lt;/div&gt;  
처럼 값 선언 부분과 비지니스 처러 부분을 따로하고비니지스 처리 부분만 HTML 주석처리 해주면 된다.


[🔗link](http://www.mins01.com/mh/tech/read/867)
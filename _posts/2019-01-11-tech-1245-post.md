---
title: "라라벨, laravel 로 샘플 만들어 보자. (4)(end) view , controller"
date: 2019-01-11 11:16:58 +0900
categories: [라라벨, laravel, 샘플, sample]
---

### controller 수정

app\Http\Controllers\SimpleCommentController.php  
`<?php <br></br>namespace App\Http\Controllers;<br></br>use App\SimpleComment;use Illuminate\Http\Request;<br></br>class SimpleCommentController extends Controller{  /**  * Display a listing of the resource.  *  * @return \Illuminate\Http\Response  */  public function index()  {    return [      'result'=&gt;true,      'count' =&gt; SimpleComment::count(),      'simpleComments' =&gt; SimpleComment::lists(),    ];    // return View('sc/index');    //  }    /**  * Store a newly created resource in storage.  *  * @param  \Illuminate\Http\Request  $request  * @return \Illuminate\Http\Response  */  public function store(Request $request)  {    //  }    /**  * Display the specified resource.  *  * @param  \App\SimpleComment  $simpleComment  * @return \Illuminate\Http\Response  */  public function show(SimpleComment $simpleComment)  {    //  }    /**  * Update the specified resource in storage.  *  * @param  \Illuminate\Http\Request  $request  * @param  \App\SimpleComment  $simpleComment  * @return \Illuminate\Http\Response  */  public function update(Request $request, SimpleComment $simpleComment)  {    if(!$simpleComment-&gt;checkScPass($request-&gt;input('sc_pass'))){      return [        'result'=&gt;false,        'message'=&gt;'Incorrect password',      ];    }    $simpleComment-&gt;update($request-&gt;all());    return $this-&gt;index();}    /**  * Remove the specified resource from storage.  *  * @param  \App\SimpleComment  $simpleComment  * @return \Illuminate\Http\Response  */  // $request 를 추가, 제어 역전으로 알아서 데이터를 전달 해 준다.  public function destroy(Request $request, SimpleComment $simpleComment)  {    if(!$simpleComment-&gt;checkScPass($request-&gt;input('sc_pass'))){      return [        'result'=&gt;false,        'message'=&gt;'Incorrect password',      ];    }    $simpleComment-&gt;delete();    return $this-&gt;index();  }}<h3>API쪽 route 수정 (경로가 모델명에 안 맞으면 컨트롤러에서 모델을 제대로 못 가져옮)</h3>routes\api.php<br></br><strike>Route::resource('sc', 'SimpleCommentController');</strike>Route::resource('simpleComment', 'SimpleCommentController');<h3>web 쪽 route 추가</h3>routes\web.phpRoute::any('/sc','WebSimpleCommentController@index');<br></br><h3>web 쪽 controller 추가</h3>app\Http\Controllers\WebSimpleCommentController.php<?php <br></br>namespace App\Http\Controllers;<br></br>use Illuminate\Http\Request;<br></br>class WebSimpleCommentController extends Controller{protected $title='SimpleComment';    public function index($value='')    {    return View('sc.lists',['title'=&gt;$this-&gt;title]);    }}<h3>web 쪽 view 파일</h3>resources\views\sc\lists.blade.php<code style="font-size: 12.6px;">@extends('sc.master')<br></br>@section('title', $title)<br></br>@section('content')<h1>SimpleComment</h1><ul class="list-group" v-for="sc in res.simpleComments"></ul><li class="list-group-item"></li><form action="{{ route('simpleComment.update',':sc_id') }}" onsubmit="ajax_action.action(this);return false;"></form>{{ csrf_field() }}<input disabled="disabled" name="_method" type="text" value=""></input><input name="sc_id" readonly="readonly" type="text" v-model="sc.sc_id"></input><input name="sc_pass" type="password"></input><input name="sc_name" type="text" v-model="sc.sc_name"></input><input name="sc_comment" type="text" v-model="sc.sc_comment"></input><input disabled="disabled" type="created_at" v-model="sc.created_at"></input><input disabled="disabled" type="updated_at" v-model="sc.updated_at"></input><button onclick="this.form._method.value='PUT'">modify</button><button onclick="this.form._method.value='DELETE'">delete</button><br></br><script></script>window.Laravel = {!! json_encode([ 'csrfToken' =&gt; csrf_token(),]) !!};        // vue.js의 app을 생성var sc_app = new Vue({el: '#sc_app',data: {res:{'result':null,message:'','count':0,'simpleComments':[]},}})$(function(){ajax_action.lists();})var ajax_action = {"lists":function(){var url = "{{ route('simpleComment.index') }}";$.ajax({url: url,type: 'GET', //GETdataType: 'json', //xml, json, script, jsonp, or html// data: post_data,}).done(function(rData) { //통신 성공 시 호출console.log("success");if(!rData.result){alert(rData.message)}else{sc_app.res = rData;}}).fail(function() { //통신 실패 시 호출console.log("error");}).always(function() { //성공/실패 후 호출.console.log("complete");});},"action":function(f){var url = f.action.replace(":sc_id",f.sc_id.value);var post_data = $(f).serialize();$.ajax({url: url,type: f._method.value, //GETdataType: 'json', //xml, json, script, jsonp, or htmldata: post_data,}).done(function(rData) { //통신 성공 시 호출console.log("success");if(!rData.result){alert(rData.message)}else{sc_app.res = rData;}}).fail(function(e) { //통신 실패 시 호출console.log(e);}).always(function() { //성공/실패 후 호출.console.log("complete");});f._method.value = '';}}<br></br><code style="white-space:pre">API LISTS+--------+-----------+------------------+------------+------------------------------------------------------+------------+| Domain | Method    | URI              | Name       | Action                                               | Middleware |+--------+-----------+------------------+------------+------------------------------------------------------+------------+|        | GET|HEAD  | api/sc           | sc.index   | App\Http\Controllers\SimpleCommentController@index   | api        ||        | POST      | api/sc           | sc.store   | App\Http\Controllers\SimpleCommentController@store   | api        ||        | GET|HEAD  | api/sc/create    | sc.create  | App\Http\Controllers\SimpleCommentController@create  | api        ||        | GET|HEAD  | api/sc/{sc}      | sc.show    | App\Http\Controllers\SimpleCommentController@show    | api        ||        | PUT|PATCH | api/sc/{sc}      | sc.update  | App\Http\Controllers\SimpleCommentController@update  | api        ||        | DELETE    | api/sc/{sc}      | sc.destroy | App\Http\Controllers\SimpleCommentController@destroy | api        ||        | GET|HEAD  | api/sc/{sc}/edit | sc.edit    | App\Http\Controllers\SimpleCommentController@edit    | api        |+--------+-----------+------------------+------------+------------------------------------------------------+------------+@endsection<br></br>`


[🔗link](http://www.mins01.com/mh/tech/read/1245)